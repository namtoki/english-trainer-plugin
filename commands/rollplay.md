# /evt:rollplay コマンド

英会話ロールプレイ練習用コマンドです。

## 引数: $ARGUMENTS

---

## サブコマンドの判定

### `start` の場合

ロールプレイを開始します。以下の「開始処理」セクションを実行してください。

### `end` の場合

ロールプレイを終了します。以下の「終了処理」セクションを実行してください。

### 引数なし、または不明な引数の場合

以下のメッセージを表示してください:
```
使用方法:
- `/evt:rollplay start` - ロールプレイを開始
- `/evt:rollplay end` - ロールプレイを終了し、会話ログを保存
```

---

## 開始処理 (start)

### 1. words/ ディレクトリの読み込み

Grep ツールを使って学習済みの表現を効率的に取得してください:

```
pattern: ^[ \t]*- `.+`
path: words/
glob: *.md
output_mode: content
```

### 2. 最新ニュースの取得

WebSearch を使用して最新のニュースを検索し、会話のトピックを1つ選んでください:
- 政治・経済・テクノロジー・エンタメ・スポーツなど幅広いジャンルから選択
- 議論しやすい、意見を述べやすいトピックを優先

### 3. VoiceMode の確認

MCP Server `voicemode` が利用可能か確認し、利用可能であれば音声モードで会話を行います:
- `voicemode` の `converse` ツールを使用して音声会話を開始
- 利用できない場合はテキストベースで会話を続行

### 4. 会話の開始

選んだトピックについて、カジュアルな口調でユーザに話しかけてください:
- 口頭での会話を想定（カジュアル・自然な英語）
- 最初の発言は2-3文程度
- ユーザが返答しやすい質問を含める
- **VoiceMode 利用時**: `speak` ツールで発話してからユーザの音声入力を待つ

例:
```
Hey, did you hear about [topic]? I was just reading about it and thought it was pretty interesting. What do you think about it?
```

---

## 会話中の処理

### ユーザの発言への対応

1. **意訳の確認**
   ユーザの英語入力に対して、まず意訳を確認してください:
   ```
   あなたの言いたかったことは「〜〜」ですよね？
   ```
   - AskUserQuestion ツールを使用して YES/NO を選択させる

2. **NO の場合**
   - ユーザに「どういう意味を伝えたかったか」を日本語で入力してもらう
   - その意図に沿った、より自然な英語表現を提案

3. **YES の場合**
   - ユーザの表現が自然かどうかを評価
   - 改善点があれば、より自然な言い方を提案

### フィードバックのフォーマット

```
---
**Your expression:** [ユーザの発言]
**Intended meaning:** [意訳]

**More natural way to say it:**
> [より自然な表現]

**Tips:**
- [改善ポイントの説明]

**Related expressions from your vocabulary:**
- `word` - [words/ にある場合、該当する表現を表示]
---
```

### 会話の継続

フィードバック後、トピックに関連した次の発言で会話を続けてください:
- ユーザの意見に反応する
- 新しい質問や視点を提供する
- 自然な会話の流れを維持

---

## 終了処理 (end)

### 1. 会話ログの整理

このセッションでの会話を以下のフォーマットで整理してください:

```markdown
# Roleplay Session - [トピック名]

**Date:** YYYY-MM-DD
**Topic:** [選んだニューストピック]

---

## Conversation Log

### Exchange 1
**Assistant:** [Assistantの発言]

**User (white):** [ユーザの元の発言]
**User (意図):** [意訳・意図]
**User (blue):** [より自然な表現]

**Tips:**
- [改善ポイント]

---

### Exchange 2
...

---

## Summary

### Key Corrections
1. [主な修正ポイント1]
2. [主な修正ポイント2]
...

### New Expressions Learned
- `expression` - 意味・使い方

### Good Points
- [ユーザの良かった表現があれば記載]
```

### 2. ファイル名の決定

1. 今日の日付を `YYYYMMDD` 形式で取得
2. `rollplay/` ディレクトリ内の同日のファイルを確認 (Glob で `rollplay/YYYYMMDD_*.md` を検索)
3. インデックス x を決定:
   - 同日のファイルがなければ x = 1
   - 既存ファイルがあれば、最大のインデックス + 1

### 3. ファイルの保存

`rollplay/YYYYMMDD_x.md` に会話ログを Write で保存してください。

### 4. 終了メッセージ

```
ロールプレイを終了しました。
会話ログを保存しました: rollplay/YYYYMMDD_x.md

お疲れ様でした！
```

---

## 注意事項

- 口頭会話を想定: 書き言葉ではなく、話し言葉として自然かを重視
- カジュアル寄り: フォーマルすぎない表現を推奨
- words/ の表現を積極的に参照: 学習済み表現が使える場面では必ず言及
- 励ましも忘れずに: 良い表現があれば褒める
- **VoiceMode 利用時**: 各発言を `speak` ツールで読み上げ、ユーザの返答は `listen` で取得
